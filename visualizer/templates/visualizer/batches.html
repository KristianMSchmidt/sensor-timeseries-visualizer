{% extends 'visualizer/_base.html' %}

{% block title %}Batches{% endblock title %}

{% block content %}

{% for batch_id in batch_ids %}
    {% if not 'TEST' in batch_id %}
        <a class="btn btn-outline-primary my-3" href="{% url 'batches' batch_id %}">{{ batch_id }}</a>
    {% endif %}
{% endfor %}

<h2 class="mt-4"><span class="text-black-50">Batch:</span> {{ batch_info.batch_id }}</h2>
<ul>
    <li>Start date: {{ batch_info.start_date|date:"Y-m-d H:i:s" }}</li>
    <li>End date: {{ batch_info.end_date|date:"Y-m-d H:i:s" }}</li>
    <li>Duration: {{ batch_info.duration }} </li>
    <li># Time steps: {{ time_steps }}</li>
</ul>

<h3 class="mt-4">Sensor Data</h3>
<p class="text-muted">Click labels to show/hide data</p>
<canvas class="mb-5" id="sensor-data-chart"></canvas>

{% endblock content %}

{% block javascript %}
<!-- Javascript for rendering chart -->
<script>  
  const config = {
    type: 'line',
    data: {
      labels: [],
      datasets: [
        {
            data: {{ 400E_Temp1|safe }},  
            label: "Temp1",
            borderWidth: 1,
            borderColor: "#3e95cd",
            fill: false
        },
        {
            data: {{ 400E_Temp2|safe }}, 
            label: "Temp2",
            borderWidth: 1,
            borderColor: "red",
            fill: false
        },
        {
            data: {{ 400E_PH1|safe }},  
            label: "PH1",
            borderWidth: 1,
            borderColor: "green",
            fill: false
        }, 
        {
            data: {{ 400E_PH2|safe }}, 
            label: "PH2",
            borderWidth: 1,
            borderColor: "orange",
            fill: false
        },
      ]
    },
    options: {
      scales: {
          x: {
              type: 'timeseries', // not different from type:'time' in our case as timesteps are equidistant
              time: {
                unit: 'hour',
                tooltipFormat:'yyyy-MM-dd HH:mm:ss',
                displayFormats: {
                  hour: 'HH:mm'
                },
              },
          }
      },
      parsing: {
        xAxisKey: 'timestamp',
        yAxisKey: 'value'
      }
    }
  };    
  const ctx = document.getElementById("sensor-data-chart").getContext('2d');
  new Chart(ctx, config);
   
</script>
{% endblock javascript %}

